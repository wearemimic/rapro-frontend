FROM node:18-bullseye

WORKDIR /app

# âœ… Disable native Rollup binary resolution for ARM (critical fix)
# ENV ROLLUP_NO_BINARY=true

COPY package*.json ./

# Reinstall everything fresh
RUN npm install
# Install sortablejs package
RUN npm install --save sortablejs

COPY . .

# Use existing node user for security (best practice)
RUN chown -R node:node /app
USER node

EXPOSE 3000
CMD ["npm", "run", "dev"]